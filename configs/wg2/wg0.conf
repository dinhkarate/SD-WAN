# WG2 (VPS2) WireGuard Configuration
# Tunnel: WG1 <-> WG2 (exit node for non-special traffic)

[Interface]
# Private key for WG2 (generate with: wg genkey)
PrivateKey = UI7aGKjEvFsqFLPgwdH9pyIcaKc3PJCT86J5cRmuH2M=

# WG2's IP in the WG1 tunnel network
Address = 10.20.0.2/24

# Listen port
ListenPort = 51821

# Enable NAT for outgoing traffic
PostUp = iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostUp = iptables -A FORWARD -i wg0 -j ACCEPT
PostUp = iptables -A FORWARD -o wg0 -m state --state RELATED,ESTABLISHED -j ACCEPT
PostUp = sysctl -w net.ipv4.ip_forward=1

PostDown = iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT
PostDown = iptables -D FORWARD -o wg0 -m state --state RELATED,ESTABLISHED -j ACCEPT

[Peer]
# WG1's public key (for wg1 interface)
PublicKey = juZFHumCzpJM1yfVk+ly7qa77E4XwV9biEpl63hE2n8=

# Allow traffic from WG1's tunnel network + PC1's network
AllowedIPs = 10.20.0.1/32, 10.10.0.0/24
