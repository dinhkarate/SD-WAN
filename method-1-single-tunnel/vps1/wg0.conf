#===============================================================================
# VPS1 WireGuard Server Configuration (Method 1 - Single Tunnel)
# File: /etc/wireguard/wg0.conf
# VPS1 là WG Server nhận từ PC và VPS2, forward traffic giữa chúng
#===============================================================================

[Interface]
# IP của VPS1 trong WireGuard network
Address = 10.0.0.1/24

# Private key của VPS1 (sẽ được tự động thay thế bởi setup.sh)
PrivateKey = <VPS1_PRIVATE_KEY>

# Port lắng nghe
ListenPort = 51820

# ===== IP Forward Rules =====
# Bật IP Forward
PostUp = sysctl -w net.ipv4.ip_forward=1

# Forward traffic giữa các peers trong wg0
PostUp = iptables -A FORWARD -i wg0 -o wg0 -j ACCEPT

PostDown = iptables -D FORWARD -i wg0 -o wg0 -j ACCEPT

#===============================================================================
# PEER: PC Client
#===============================================================================
[Peer]
# Public key của PC (thay thế sau khi tạo key trên PC)
PublicKey = <PC_PUBLIC_KEY>

# IP được phép của PC trong tunnel
AllowedIPs = 10.0.0.2/32

#===============================================================================
# PEER: VPS2 Client (Gateway ra Internet)
#===============================================================================
[Peer]
# Public key của VPS2 (thay thế sau khi chạy setup trên VPS2)
PublicKey = <VPS2_PUBLIC_KEY>

# IP được phép của VPS2 + tất cả traffic Internet sẽ được route qua VPS2
AllowedIPs = 10.0.0.3/32, 0.0.0.0/0

# VPS2 sẽ kết nối đến VPS1 nên không cần Endpoint ở đây
# PersistentKeepalive không cần vì VPS2 là client sẽ giữ kết nối
