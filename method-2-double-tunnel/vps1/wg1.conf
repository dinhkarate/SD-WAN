#===============================================================================
# VPS1 WireGuard Client Configuration (Method 2)
# File: /etc/wireguard/wg1.conf
# Kết nối đến VPS2 để route traffic ra Internet
#
# ⚠️ POLICY ROUTING:
# - Table 51821 được dùng để tránh mất kết nối SSH đến VPS1
# - CHỈ traffic từ PC (10.0.0.0/24) mới đi qua wg1 → VPS2
# - Traffic của VPS1 (SSH, updates) vẫn đi trực tiếp ra Internet
#===============================================================================

[Interface]
# IP của VPS1 trong WireGuard network (tunnel 2 - với VPS2)
Address = 10.0.1.2/24

# Private key của wg1 (sẽ được tự động thay thế bởi setup.sh)
PrivateKey = <VPS1_WG1_PRIVATE_KEY>

# Không cần ListenPort vì đây là client

# ===== ROUTING TABLE RIÊNG =====
# WireGuard sẽ tạo route trong table 51821 thay vì table main
# Điều này đảm bảo VPS1 không bị mất kết nối SSH
# Route 0.0.0.0/0 sẽ vào table 51821, không ảnh hưởng VPS1
Table = 51821

#===============================================================================
# PEER: VPS2 (WireGuard Server + NAT)
#===============================================================================
[Peer]
# Public key của VPS2 (lấy từ VPS2 sau khi chạy setup)
PublicKey = <VPS2_PUBLIC_KEY>

# Endpoint: IP public và port của VPS2
Endpoint = VPS2_PUBLIC_IP:51821

# AllowedIPs xác định traffic nào được gửi qua tunnel này
# 0.0.0.0/0 = cho phép gửi BẤT KỲ traffic nào qua tunnel
# QUAN TRỌNG: Route này chỉ được tạo trong table 51821
# Traffic từ PC (10.0.0.0/24) sẽ được forward qua wg1 nhờ ip rule trong wg0.conf
AllowedIPs = 0.0.0.0/0, ::/0

# Giữ kết nối sống (quan trọng vì VPS1 là client)
PersistentKeepalive = 25
